<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            box-sizing: border-box;
        }
        .card-regin{
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }
        .card{
            /* background-color: rgb(183, 183, 255); */
            border: 1px dashed rgb(120, 120, 120);
            width: calc((100% - 30px * 3) / 3);
            height: 300px;
            margin-right: 20px;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <button class="nav-btn">全省</button>
    <button class="nav-btn">北部</button>
    <button class="nav-btn">中部</button>
    <button class="nav-btn">南部</button>
    <button class="nav-btn">東部</button>
    <button class="nav-btn">離島</button>
    <div class="card-regin">
    </div>
    <script>
        let btnAll = document.querySelectorAll('.nav-btn');

        let cities = [
            ['基隆市', '新北市', '臺北市', '桃園市', '新竹市', '新竹縣', '苗栗縣', '臺中市', '南投縣', '彰化縣', '雲林縣', '嘉義市', '嘉義縣', '臺南市', '高雄市', '屏東縣', '宜蘭縣', '花蓮縣', '臺東縣', '澎湖縣', '金門縣', '連江縣'],
            ['基隆市','宜蘭縣', '新北市', '臺北市', '桃園市', '新竹市', '新竹縣'], 
            ['臺中市', '南投縣', '苗栗縣', '彰化縣'],
            [, '雲林縣', '嘉義市', '嘉義縣','臺南市', '高雄市', '屏東縣'],
            ['花蓮縣', '臺東縣'], ['澎湖縣', '金門縣', '連江縣'],
        ];
        let nowCities = cities[0];
        let orgData = {};


        let url = 'https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=CWA-6B08A55F-8F83-49C2-82D5-2D9BC29EB9C6';

        fetch_data();

        btnAll.forEach((btn,index) => {
            btn.addEventListener('click',() => {
                console.log(999,index);
                nowCities = cities[index];
                fetch_data();
            });
        });
        
        function fetch_data() {
        fetch(url)
            .then(function(response) {
                return response.json();
            })
       .then(function(datas) {
            console.log(datas);
            // 1.組織資料
            organizaionData(datas);
            // 2.處理城市
            arrangeCity (datas);
        });
    }
            

            console.log(1);
            console.log(2);
            console.log(2);
            // 所有程式要寫在這
        

   
       function organizaionData(data) {
        // console.log(data.records.location);
        let locationAll= data.records.location;
        console.log(locationAll);
        locationAll.forEach(location => {
            let locationName = location.locationName; //取每個地區的名子
            let loc_wE_t0 = location.weatherElement[0].time[0];
            //每個地區的天氣和時間
            
            let wxCondition = loc_wE_t0.parameter.parameterName; // 晴時多雲的天氣
           
            let startTime = loc_wE_t0.startTime;
            let endTime = loc_wE_t0.endTime; //日期時間
           
            let maxT = location.weatherElement[4].time[0].parameter.parameterName;
            let minT = location.weatherElement[2].time[0].parameter.parameterName;
            let pop = location.weatherElement[1].time[0].parameter.parameterName;
            let ci = location.weatherElement[3].time[0].parameter.parameterName;
            console.log(maxT);
            orgData[locationName] = {
                'wxCondition':wxCondition,
                'startTime':startTime,
                'endTime':endTime,
                'maxT':maxT,
                'minT':minT,
                'pop':pop,
                'ci':ci,
            }

        });


        console.log(orgData);
       }
       function arrangeCity() {
        let cardRegin = document.querySelector('.card-regin');
        cardRegin.innerHTML = '';
        nowCities.forEach((city, index) =>{
            let cityData = orgData[city];
            console.log(city,cityData);
            cardRegin.innerHTML += 
            `<div class="card">
                <span class="city">${city}</span>
                <br>
                <span>${cityData.startTime} - ${cityData.endTime}</span>
                <br>
                <span>天氣${cityData.wxCondition}</span>
                <br>
                <span>溫度${cityData.minT} &deg;C - ${cityData.maxT} &deg;C </span>
                <br>
                <span>雨${cityData.pop} %</span>
                <br>
                <span>體感${cityData.ci} </span>
            </div>`
        })
       }
    </script>
</body>
</html>